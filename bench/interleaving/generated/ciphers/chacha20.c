/* This code was generated by Usuba.
   See https://github.com/DadaIsCrazy/usuba.
   From the file "samples/usuba/chacha20.ua" (included below). */

#include <stdint.h>

/* Do NOT change the order of those define/include */

#ifndef BITS_PER_REG
#define BITS_PER_REG 32
#endif
/* including the architecture specific .h */
#include "STD.h"

/* auxiliary functions */


/* main function */
void Chacha20__ (/*inputs*/ DATATYPE plain__[16], /*outputs*/ DATATYPE cipher__[16]) {

  // Variables declaration
  DATATYPE DR__V32_1_QR__V32_1__shadow_a__1_;
  DATATYPE DR__V32_1_QR__V32_1__shadow_b__4_;
  DATATYPE DR__V32_1_QR__V32_1__shadow_c__3_;
  DATATYPE DR__V32_1_QR__V32_1__shadow_d__2_;
  DATATYPE DR__V32_1_QR__V32_1__tmp1_;
  DATATYPE DR__V32_1_QR__V32_1__tmp2_;
  DATATYPE DR__V32_1_QR__V32_1__tmp3_;
  DATATYPE DR__V32_1_QR__V32_1__tmp4_;
  DATATYPE DR__V32_1_QR__V32_2__shadow_a__1_;
  DATATYPE DR__V32_1_QR__V32_2__shadow_b__4_;
  DATATYPE DR__V32_1_QR__V32_2__shadow_c__3_;
  DATATYPE DR__V32_1_QR__V32_2__shadow_d__2_;
  DATATYPE DR__V32_1_QR__V32_2__tmp1_;
  DATATYPE DR__V32_1_QR__V32_2__tmp2_;
  DATATYPE DR__V32_1_QR__V32_2__tmp3_;
  DATATYPE DR__V32_1_QR__V32_2__tmp4_;
  DATATYPE DR__V32_1_QR__V32_3__shadow_a__1_;
  DATATYPE DR__V32_1_QR__V32_3__shadow_b__4_;
  DATATYPE DR__V32_1_QR__V32_3__shadow_c__3_;
  DATATYPE DR__V32_1_QR__V32_3__shadow_d__2_;
  DATATYPE DR__V32_1_QR__V32_3__tmp1_;
  DATATYPE DR__V32_1_QR__V32_3__tmp2_;
  DATATYPE DR__V32_1_QR__V32_3__tmp3_;
  DATATYPE DR__V32_1_QR__V32_3__tmp4_;
  DATATYPE DR__V32_1_QR__V32_4__shadow_a__1_;
  DATATYPE DR__V32_1_QR__V32_4__shadow_b__4_;
  DATATYPE DR__V32_1_QR__V32_4__shadow_c__3_;
  DATATYPE DR__V32_1_QR__V32_4__shadow_d__2_;
  DATATYPE DR__V32_1_QR__V32_4__tmp1_;
  DATATYPE DR__V32_1_QR__V32_4__tmp2_;
  DATATYPE DR__V32_1_QR__V32_4__tmp3_;
  DATATYPE DR__V32_1_QR__V32_4__tmp4_;
  DATATYPE DR__V32_1_QR__V32_5__shadow_a__1_;
  DATATYPE DR__V32_1_QR__V32_5__shadow_b__4_;
  DATATYPE DR__V32_1_QR__V32_5__shadow_c__3_;
  DATATYPE DR__V32_1_QR__V32_5__shadow_d__2_;
  DATATYPE DR__V32_1_QR__V32_5__tmp1_;
  DATATYPE DR__V32_1_QR__V32_5__tmp2_;
  DATATYPE DR__V32_1_QR__V32_5__tmp3_;
  DATATYPE DR__V32_1_QR__V32_5__tmp4_;
  DATATYPE DR__V32_1_QR__V32_6__shadow_a__1_;
  DATATYPE DR__V32_1_QR__V32_6__shadow_b__4_;
  DATATYPE DR__V32_1_QR__V32_6__shadow_c__3_;
  DATATYPE DR__V32_1_QR__V32_6__shadow_d__2_;
  DATATYPE DR__V32_1_QR__V32_6__tmp1_;
  DATATYPE DR__V32_1_QR__V32_6__tmp2_;
  DATATYPE DR__V32_1_QR__V32_6__tmp3_;
  DATATYPE DR__V32_1_QR__V32_6__tmp4_;
  DATATYPE DR__V32_1_QR__V32_7__shadow_a__1_;
  DATATYPE DR__V32_1_QR__V32_7__shadow_b__4_;
  DATATYPE DR__V32_1_QR__V32_7__shadow_c__3_;
  DATATYPE DR__V32_1_QR__V32_7__shadow_d__2_;
  DATATYPE DR__V32_1_QR__V32_7__tmp1_;
  DATATYPE DR__V32_1_QR__V32_7__tmp2_;
  DATATYPE DR__V32_1_QR__V32_7__tmp3_;
  DATATYPE DR__V32_1_QR__V32_7__tmp4_;
  DATATYPE DR__V32_1_QR__V32_8__shadow_a__1_;
  DATATYPE DR__V32_1_QR__V32_8__shadow_b__4_;
  DATATYPE DR__V32_1_QR__V32_8__shadow_c__3_;
  DATATYPE DR__V32_1_QR__V32_8__shadow_d__2_;
  DATATYPE DR__V32_1_QR__V32_8__tmp1_;
  DATATYPE DR__V32_1_QR__V32_8__tmp2_;
  DATATYPE DR__V32_1_QR__V32_8__tmp3_;
  DATATYPE DR__V32_1_QR__V32_8__tmp4_;
  DATATYPE DR__V32_1__shadow_state__10_;
  DATATYPE DR__V32_1__shadow_state__11_;
  DATATYPE DR__V32_1__shadow_state__12_;
  DATATYPE DR__V32_1__shadow_state__13_;
  DATATYPE DR__V32_1__shadow_state__14_;
  DATATYPE DR__V32_1__shadow_state__15_;
  DATATYPE DR__V32_1__shadow_state__16_;
  DATATYPE DR__V32_1__shadow_state__17_;
  DATATYPE DR__V32_1__shadow_state__18_;
  DATATYPE DR__V32_1__shadow_state__19_;
  DATATYPE DR__V32_1__shadow_state__20_;
  DATATYPE DR__V32_1__shadow_state__5_;
  DATATYPE DR__V32_1__shadow_state__6_;
  DATATYPE DR__V32_1__shadow_state__7_;
  DATATYPE DR__V32_1__shadow_state__8_;
  DATATYPE DR__V32_1__shadow_state__9_;
  DATATYPE state__[16];

  // Instructions (body)
  state__[0] = plain__[0];
  state__[1] = plain__[1];
  state__[2] = plain__[2];
  state__[3] = plain__[3];
  state__[4] = plain__[4];
  state__[5] = plain__[5];
  state__[6] = plain__[6];
  state__[7] = plain__[7];
  state__[8] = plain__[8];
  state__[9] = plain__[9];
  state__[10] = plain__[10];
  state__[11] = plain__[11];
  state__[12] = plain__[12];
  state__[13] = plain__[13];
  state__[14] = plain__[14];
  state__[15] = plain__[15];
  for (int i__ = 1; i__ <= 10; i__++) {
    DR__V32_1_QR__V32_1__shadow_a__1_ = ADD(state__[0],state__[4],32);
    DR__V32_1_QR__V32_2__shadow_a__1_ = ADD(state__[1],state__[5],32);
    DR__V32_1_QR__V32_3__shadow_a__1_ = ADD(state__[2],state__[6],32);
    DR__V32_1_QR__V32_4__shadow_a__1_ = ADD(state__[3],state__[7],32);
    DR__V32_1_QR__V32_1__tmp1_ = XOR(state__[12],DR__V32_1_QR__V32_1__shadow_a__1_);
    DR__V32_1_QR__V32_2__tmp1_ = XOR(state__[13],DR__V32_1_QR__V32_2__shadow_a__1_);
    DR__V32_1_QR__V32_3__tmp1_ = XOR(state__[14],DR__V32_1_QR__V32_3__shadow_a__1_);
    DR__V32_1_QR__V32_4__tmp1_ = XOR(state__[15],DR__V32_1_QR__V32_4__shadow_a__1_);
    DR__V32_1_QR__V32_1__shadow_d__2_ = L_ROTATE(DR__V32_1_QR__V32_1__tmp1_,16,32);
    DR__V32_1_QR__V32_2__shadow_d__2_ = L_ROTATE(DR__V32_1_QR__V32_2__tmp1_,16,32);
    DR__V32_1_QR__V32_3__shadow_d__2_ = L_ROTATE(DR__V32_1_QR__V32_3__tmp1_,16,32);
    DR__V32_1_QR__V32_4__shadow_d__2_ = L_ROTATE(DR__V32_1_QR__V32_4__tmp1_,16,32);
    DR__V32_1_QR__V32_1__shadow_c__3_ = ADD(state__[8],DR__V32_1_QR__V32_1__shadow_d__2_,32);
    DR__V32_1_QR__V32_2__shadow_c__3_ = ADD(state__[9],DR__V32_1_QR__V32_2__shadow_d__2_,32);
    DR__V32_1_QR__V32_3__shadow_c__3_ = ADD(state__[10],DR__V32_1_QR__V32_3__shadow_d__2_,32);
    DR__V32_1_QR__V32_4__shadow_c__3_ = ADD(state__[11],DR__V32_1_QR__V32_4__shadow_d__2_,32);
    DR__V32_1_QR__V32_1__tmp2_ = XOR(state__[4],DR__V32_1_QR__V32_1__shadow_c__3_);
    DR__V32_1_QR__V32_2__tmp2_ = XOR(state__[5],DR__V32_1_QR__V32_2__shadow_c__3_);
    DR__V32_1_QR__V32_3__tmp2_ = XOR(state__[6],DR__V32_1_QR__V32_3__shadow_c__3_);
    DR__V32_1_QR__V32_4__tmp2_ = XOR(state__[7],DR__V32_1_QR__V32_4__shadow_c__3_);
    DR__V32_1_QR__V32_1__shadow_b__4_ = L_ROTATE(DR__V32_1_QR__V32_1__tmp2_,12,32);
    DR__V32_1_QR__V32_2__shadow_b__4_ = L_ROTATE(DR__V32_1_QR__V32_2__tmp2_,12,32);
    DR__V32_1_QR__V32_3__shadow_b__4_ = L_ROTATE(DR__V32_1_QR__V32_3__tmp2_,12,32);
    DR__V32_1_QR__V32_4__shadow_b__4_ = L_ROTATE(DR__V32_1_QR__V32_4__tmp2_,12,32);
    DR__V32_1__shadow_state__5_ = ADD(DR__V32_1_QR__V32_1__shadow_a__1_,DR__V32_1_QR__V32_1__shadow_b__4_,32);
    DR__V32_1__shadow_state__9_ = ADD(DR__V32_1_QR__V32_2__shadow_a__1_,DR__V32_1_QR__V32_2__shadow_b__4_,32);
    DR__V32_1__shadow_state__13_ = ADD(DR__V32_1_QR__V32_3__shadow_a__1_,DR__V32_1_QR__V32_3__shadow_b__4_,32);
    DR__V32_1__shadow_state__17_ = ADD(DR__V32_1_QR__V32_4__shadow_a__1_,DR__V32_1_QR__V32_4__shadow_b__4_,32);
    DR__V32_1_QR__V32_1__tmp3_ = XOR(DR__V32_1_QR__V32_1__shadow_d__2_,DR__V32_1__shadow_state__5_);
    DR__V32_1_QR__V32_2__tmp3_ = XOR(DR__V32_1_QR__V32_2__shadow_d__2_,DR__V32_1__shadow_state__9_);
    DR__V32_1_QR__V32_3__tmp3_ = XOR(DR__V32_1_QR__V32_3__shadow_d__2_,DR__V32_1__shadow_state__13_);
    DR__V32_1_QR__V32_4__tmp3_ = XOR(DR__V32_1_QR__V32_4__shadow_d__2_,DR__V32_1__shadow_state__17_);
    DR__V32_1__shadow_state__8_ = L_ROTATE(DR__V32_1_QR__V32_1__tmp3_,8,32);
    DR__V32_1__shadow_state__12_ = L_ROTATE(DR__V32_1_QR__V32_2__tmp3_,8,32);
    DR__V32_1__shadow_state__16_ = L_ROTATE(DR__V32_1_QR__V32_3__tmp3_,8,32);
    DR__V32_1__shadow_state__20_ = L_ROTATE(DR__V32_1_QR__V32_4__tmp3_,8,32);
    DR__V32_1__shadow_state__7_ = ADD(DR__V32_1_QR__V32_1__shadow_c__3_,DR__V32_1__shadow_state__8_,32);
    DR__V32_1__shadow_state__11_ = ADD(DR__V32_1_QR__V32_2__shadow_c__3_,DR__V32_1__shadow_state__12_,32);
    DR__V32_1__shadow_state__15_ = ADD(DR__V32_1_QR__V32_3__shadow_c__3_,DR__V32_1__shadow_state__16_,32);
    DR__V32_1__shadow_state__19_ = ADD(DR__V32_1_QR__V32_4__shadow_c__3_,DR__V32_1__shadow_state__20_,32);
    DR__V32_1_QR__V32_1__tmp4_ = XOR(DR__V32_1_QR__V32_1__shadow_b__4_,DR__V32_1__shadow_state__7_);
    DR__V32_1_QR__V32_2__tmp4_ = XOR(DR__V32_1_QR__V32_2__shadow_b__4_,DR__V32_1__shadow_state__11_);
    DR__V32_1_QR__V32_3__tmp4_ = XOR(DR__V32_1_QR__V32_3__shadow_b__4_,DR__V32_1__shadow_state__15_);
    DR__V32_1_QR__V32_4__tmp4_ = XOR(DR__V32_1_QR__V32_4__shadow_b__4_,DR__V32_1__shadow_state__19_);
    DR__V32_1__shadow_state__6_ = L_ROTATE(DR__V32_1_QR__V32_1__tmp4_,7,32);
    DR__V32_1__shadow_state__10_ = L_ROTATE(DR__V32_1_QR__V32_2__tmp4_,7,32);
    DR__V32_1__shadow_state__14_ = L_ROTATE(DR__V32_1_QR__V32_3__tmp4_,7,32);
    DR__V32_1__shadow_state__18_ = L_ROTATE(DR__V32_1_QR__V32_4__tmp4_,7,32);
    DR__V32_1_QR__V32_8__shadow_a__1_ = ADD(DR__V32_1__shadow_state__17_,DR__V32_1__shadow_state__6_,32);
    DR__V32_1_QR__V32_5__shadow_a__1_ = ADD(DR__V32_1__shadow_state__5_,DR__V32_1__shadow_state__10_,32);
    DR__V32_1_QR__V32_6__shadow_a__1_ = ADD(DR__V32_1__shadow_state__9_,DR__V32_1__shadow_state__14_,32);
    DR__V32_1_QR__V32_7__shadow_a__1_ = ADD(DR__V32_1__shadow_state__13_,DR__V32_1__shadow_state__18_,32);
    DR__V32_1_QR__V32_8__tmp1_ = XOR(DR__V32_1__shadow_state__16_,DR__V32_1_QR__V32_8__shadow_a__1_);
    DR__V32_1_QR__V32_5__tmp1_ = XOR(DR__V32_1__shadow_state__20_,DR__V32_1_QR__V32_5__shadow_a__1_);
    DR__V32_1_QR__V32_6__tmp1_ = XOR(DR__V32_1__shadow_state__8_,DR__V32_1_QR__V32_6__shadow_a__1_);
    DR__V32_1_QR__V32_7__tmp1_ = XOR(DR__V32_1__shadow_state__12_,DR__V32_1_QR__V32_7__shadow_a__1_);
    DR__V32_1_QR__V32_8__shadow_d__2_ = L_ROTATE(DR__V32_1_QR__V32_8__tmp1_,16,32);
    DR__V32_1_QR__V32_5__shadow_d__2_ = L_ROTATE(DR__V32_1_QR__V32_5__tmp1_,16,32);
    DR__V32_1_QR__V32_6__shadow_d__2_ = L_ROTATE(DR__V32_1_QR__V32_6__tmp1_,16,32);
    DR__V32_1_QR__V32_7__shadow_d__2_ = L_ROTATE(DR__V32_1_QR__V32_7__tmp1_,16,32);
    DR__V32_1_QR__V32_8__shadow_c__3_ = ADD(DR__V32_1__shadow_state__11_,DR__V32_1_QR__V32_8__shadow_d__2_,32);
    DR__V32_1_QR__V32_5__shadow_c__3_ = ADD(DR__V32_1__shadow_state__15_,DR__V32_1_QR__V32_5__shadow_d__2_,32);
    DR__V32_1_QR__V32_6__shadow_c__3_ = ADD(DR__V32_1__shadow_state__19_,DR__V32_1_QR__V32_6__shadow_d__2_,32);
    DR__V32_1_QR__V32_7__shadow_c__3_ = ADD(DR__V32_1__shadow_state__7_,DR__V32_1_QR__V32_7__shadow_d__2_,32);
    DR__V32_1_QR__V32_8__tmp2_ = XOR(DR__V32_1__shadow_state__6_,DR__V32_1_QR__V32_8__shadow_c__3_);
    DR__V32_1_QR__V32_5__tmp2_ = XOR(DR__V32_1__shadow_state__10_,DR__V32_1_QR__V32_5__shadow_c__3_);
    DR__V32_1_QR__V32_6__tmp2_ = XOR(DR__V32_1__shadow_state__14_,DR__V32_1_QR__V32_6__shadow_c__3_);
    DR__V32_1_QR__V32_7__tmp2_ = XOR(DR__V32_1__shadow_state__18_,DR__V32_1_QR__V32_7__shadow_c__3_);
    DR__V32_1_QR__V32_8__shadow_b__4_ = L_ROTATE(DR__V32_1_QR__V32_8__tmp2_,12,32);
    DR__V32_1_QR__V32_5__shadow_b__4_ = L_ROTATE(DR__V32_1_QR__V32_5__tmp2_,12,32);
    DR__V32_1_QR__V32_6__shadow_b__4_ = L_ROTATE(DR__V32_1_QR__V32_6__tmp2_,12,32);
    DR__V32_1_QR__V32_7__shadow_b__4_ = L_ROTATE(DR__V32_1_QR__V32_7__tmp2_,12,32);
    state__[3] = ADD(DR__V32_1_QR__V32_8__shadow_a__1_,DR__V32_1_QR__V32_8__shadow_b__4_,32);
    state__[0] = ADD(DR__V32_1_QR__V32_5__shadow_a__1_,DR__V32_1_QR__V32_5__shadow_b__4_,32);
    state__[1] = ADD(DR__V32_1_QR__V32_6__shadow_a__1_,DR__V32_1_QR__V32_6__shadow_b__4_,32);
    state__[2] = ADD(DR__V32_1_QR__V32_7__shadow_a__1_,DR__V32_1_QR__V32_7__shadow_b__4_,32);
    DR__V32_1_QR__V32_8__tmp3_ = XOR(DR__V32_1_QR__V32_8__shadow_d__2_,state__[3]);
    DR__V32_1_QR__V32_5__tmp3_ = XOR(DR__V32_1_QR__V32_5__shadow_d__2_,state__[0]);
    DR__V32_1_QR__V32_6__tmp3_ = XOR(DR__V32_1_QR__V32_6__shadow_d__2_,state__[1]);
    DR__V32_1_QR__V32_7__tmp3_ = XOR(DR__V32_1_QR__V32_7__shadow_d__2_,state__[2]);
    state__[14] = L_ROTATE(DR__V32_1_QR__V32_8__tmp3_,8,32);
    state__[15] = L_ROTATE(DR__V32_1_QR__V32_5__tmp3_,8,32);
    state__[12] = L_ROTATE(DR__V32_1_QR__V32_6__tmp3_,8,32);
    state__[13] = L_ROTATE(DR__V32_1_QR__V32_7__tmp3_,8,32);
    state__[9] = ADD(DR__V32_1_QR__V32_8__shadow_c__3_,state__[14],32);
    state__[10] = ADD(DR__V32_1_QR__V32_5__shadow_c__3_,state__[15],32);
    state__[11] = ADD(DR__V32_1_QR__V32_6__shadow_c__3_,state__[12],32);
    state__[8] = ADD(DR__V32_1_QR__V32_7__shadow_c__3_,state__[13],32);
    DR__V32_1_QR__V32_8__tmp4_ = XOR(DR__V32_1_QR__V32_8__shadow_b__4_,state__[9]);
    DR__V32_1_QR__V32_5__tmp4_ = XOR(DR__V32_1_QR__V32_5__shadow_b__4_,state__[10]);
    DR__V32_1_QR__V32_6__tmp4_ = XOR(DR__V32_1_QR__V32_6__shadow_b__4_,state__[11]);
    DR__V32_1_QR__V32_7__tmp4_ = XOR(DR__V32_1_QR__V32_7__shadow_b__4_,state__[8]);
    state__[4] = L_ROTATE(DR__V32_1_QR__V32_8__tmp4_,7,32);
    state__[5] = L_ROTATE(DR__V32_1_QR__V32_5__tmp4_,7,32);
    state__[6] = L_ROTATE(DR__V32_1_QR__V32_6__tmp4_,7,32);
    state__[7] = L_ROTATE(DR__V32_1_QR__V32_7__tmp4_,7,32);
  }
  cipher__[0] = state__[0];
  cipher__[1] = state__[1];
  cipher__[2] = state__[2];
  cipher__[3] = state__[3];
  cipher__[4] = state__[4];
  cipher__[5] = state__[5];
  cipher__[6] = state__[6];
  cipher__[7] = state__[7];
  cipher__[8] = state__[8];
  cipher__[9] = state__[9];
  cipher__[10] = state__[10];
  cipher__[11] = state__[11];
  cipher__[12] = state__[12];
  cipher__[13] = state__[13];
  cipher__[14] = state__[14];
  cipher__[15] = state__[15];

}

/* Additional functions */
uint32_t bench_speed() {
  /* Inputs */
  DATATYPE plain__[16] = { 0 };

  /* Preventing inputs from being optimized out */
  asm volatile("" : "+m" (plain__));

  /* Outputs */
  DATATYPE cipher__[16] = { 0 };
  /* Primitive call */
  Chacha20__(plain__,cipher__);

  /* Preventing outputs from being optimized out */
  asm volatile("" : "+m" (cipher__));

  /* Returning the number of encrypted bytes */
  return 64;
}

/* **************************************************************** */
/*                            Usuba source                          */
/*                                                                  */
/*

 node QR(a :  u<V>32 :: base,b :  u<V>32 :: base,c :  u<V>32 :: base,d :  u<V>32 :: base)
  returns aR :  u<V>32 :: base,bR :  u<V>32 :: base,cR :  u<V>32 :: base,dR :  u<V>32 :: base
vars

let
(a) := (a + b);
(d) := ((d ^ a) <<< 16);
(c) := (c + d);
(b) := ((b ^ c) <<< 12);
(aR) = (a + b);
(dR) = ((d ^ aR) <<< 8);
(cR) = (c + dR);
(bR) = ((b ^ cR) <<< 7)
tel

 node DR(state :  u<V>32x16 :: base)
  returns stateR :  u<V>32x16 :: base
vars

let
(state[0,4,8,12]) := QR(state[0,4,8,12]);
(state[1,5,9,13]) := QR(state[1,5,9,13]);
(state[2,6,10,14]) := QR(state[2,6,10,14]);
(state[3,7,11,15]) := QR(state[3,7,11,15]);
(stateR[0,5,10,15]) = QR(state[0,5,10,15]);
(stateR[1,6,11,12]) = QR(state[1,6,11,12]);
(stateR[2,7,8,13]) = QR(state[2,7,8,13]);
(stateR[3,4,9,14]) = QR(state[3,4,9,14])
tel

 node Chacha20(plain :  u<V>32x16 :: base)
  returns cipher :  u<V>32x16 :: base
vars
  state :  u<V>32x16[11] :: base
let
(state[0]) = plain;
forall i in [1,10] {
(state[i]) = DR(state[(i - 1)])
};
(cipher) = state[10]
tel

*/
 