/* This code was generated by Usuba.
   See https://github.com/DadaIsCrazy/usuba.
   From the file "samples/usuba/chacha20.ua" (included below). */

#include <stdint.h>

/* Do NOT change the order of those define/include */
#define NO_RUNTIME
#ifndef BITS_PER_REG
#define BITS_PER_REG 128
#endif
/* including the architecture specific .h */
#include "SSE.h"

/* auxiliary functions */
void QR_start__ (/*inputs*/ DATATYPE a__,DATATYPE b__,DATATYPE c__,DATATYPE d__, /*outputs*/ DATATYPE* aR__,DATATYPE* bR__,DATATYPE* cR__,DATATYPE* dR__) {
  
  // Variables declaration
  DATATYPE _tmp1_;
  DATATYPE _tmp2_;

  // Instructions (body)
  *aR__ = ADD(a__,b__,32);
  _tmp1_ = XOR(d__,*aR__);
  *dR__ = L_ROTATE(_tmp1_,16,32);
  *cR__ = ADD(c__,*dR__,32);
  _tmp2_ = XOR(b__,*cR__);
  *bR__ = L_ROTATE(_tmp2_,12,32);

}

void QR_end__ (/*inputs*/ DATATYPE a__,DATATYPE b__,DATATYPE c__,DATATYPE d__, /*outputs*/ DATATYPE* aR__,DATATYPE* bR__,DATATYPE* cR__,DATATYPE* dR__) {
  
  // Variables declaration
  DATATYPE _tmp3_;
  DATATYPE _tmp4_;

  // Instructions (body)
  *aR__ = ADD(a__,b__,32);
  _tmp3_ = XOR(d__,*aR__);
  *dR__ = L_ROTATE(_tmp3_,8,32);
  *cR__ = ADD(c__,*dR__,32);
  _tmp4_ = XOR(b__,*cR__);
  *bR__ = L_ROTATE(_tmp4_,7,32);

}

void QR__ (/*inputs*/ DATATYPE input__0__,DATATYPE input__1__,DATATYPE input__2__,DATATYPE input__3__, /*outputs*/ DATATYPE* output__0__,DATATYPE* output__1__,DATATYPE* output__2__,DATATYPE* output__3__) {
  
  // Variables declaration
  DATATYPE _tmp5_0__;
  DATATYPE _tmp5_1__;
  DATATYPE _tmp5_2__;
  DATATYPE _tmp5_3__;

  // Instructions (body)
  QR_start__(input__0__,input__1__,input__2__,input__3__,&_tmp5_0__,&_tmp5_1__,&_tmp5_2__,&_tmp5_3__);
  QR_end__(_tmp5_0__,_tmp5_1__,_tmp5_2__,_tmp5_3__,&*output__0__,&*output__1__,&*output__2__,&*output__3__);

}

void DR_start__ (/*inputs*/ DATATYPE state__0__,DATATYPE state__1__,DATATYPE state__2__,DATATYPE state__3__,DATATYPE state__4__,DATATYPE state__5__,DATATYPE state__6__,DATATYPE state__7__,DATATYPE state__8__,DATATYPE state__9__,DATATYPE state__10__,DATATYPE state__11__,DATATYPE state__12__,DATATYPE state__13__,DATATYPE state__14__,DATATYPE state__15__, /*outputs*/ DATATYPE* stateR__0__,DATATYPE* stateR__1__,DATATYPE* stateR__2__,DATATYPE* stateR__3__,DATATYPE* stateR__4__,DATATYPE* stateR__5__,DATATYPE* stateR__6__,DATATYPE* stateR__7__,DATATYPE* stateR__8__,DATATYPE* stateR__9__,DATATYPE* stateR__10__,DATATYPE* stateR__11__,DATATYPE* stateR__12__,DATATYPE* stateR__13__,DATATYPE* stateR__14__,DATATYPE* stateR__15__) {
  
  // Variables declaration
  ;

  // Instructions (body)
  QR__(state__0__,state__4__,state__8__,state__12__,&*stateR__0__,&*stateR__4__,&*stateR__8__,&*stateR__12__);
  QR__(state__1__,state__5__,state__9__,state__13__,&*stateR__1__,&*stateR__5__,&*stateR__9__,&*stateR__13__);
  QR__(state__2__,state__6__,state__10__,state__14__,&*stateR__2__,&*stateR__6__,&*stateR__10__,&*stateR__14__);
  QR__(state__3__,state__7__,state__11__,state__15__,&*stateR__3__,&*stateR__7__,&*stateR__11__,&*stateR__15__);

}

void DR_end__ (/*inputs*/ DATATYPE state__0__,DATATYPE state__1__,DATATYPE state__2__,DATATYPE state__3__,DATATYPE state__4__,DATATYPE state__5__,DATATYPE state__6__,DATATYPE state__7__,DATATYPE state__8__,DATATYPE state__9__,DATATYPE state__10__,DATATYPE state__11__,DATATYPE state__12__,DATATYPE state__13__,DATATYPE state__14__,DATATYPE state__15__, /*outputs*/ DATATYPE* stateR__0__,DATATYPE* stateR__1__,DATATYPE* stateR__2__,DATATYPE* stateR__3__,DATATYPE* stateR__4__,DATATYPE* stateR__5__,DATATYPE* stateR__6__,DATATYPE* stateR__7__,DATATYPE* stateR__8__,DATATYPE* stateR__9__,DATATYPE* stateR__10__,DATATYPE* stateR__11__,DATATYPE* stateR__12__,DATATYPE* stateR__13__,DATATYPE* stateR__14__,DATATYPE* stateR__15__) {
  
  // Variables declaration
  ;

  // Instructions (body)
  QR__(state__0__,state__5__,state__10__,state__15__,&*stateR__0__,&*stateR__5__,&*stateR__10__,&*stateR__15__);
  QR__(state__1__,state__6__,state__11__,state__12__,&*stateR__1__,&*stateR__6__,&*stateR__11__,&*stateR__12__);
  QR__(state__2__,state__7__,state__8__,state__13__,&*stateR__2__,&*stateR__7__,&*stateR__8__,&*stateR__13__);
  QR__(state__3__,state__4__,state__9__,state__14__,&*stateR__3__,&*stateR__4__,&*stateR__9__,&*stateR__14__);

}

void DR__ (/*inputs*/ DATATYPE state__0__,DATATYPE state__1__,DATATYPE state__2__,DATATYPE state__3__,DATATYPE state__4__,DATATYPE state__5__,DATATYPE state__6__,DATATYPE state__7__,DATATYPE state__8__,DATATYPE state__9__,DATATYPE state__10__,DATATYPE state__11__,DATATYPE state__12__,DATATYPE state__13__,DATATYPE state__14__,DATATYPE state__15__, /*outputs*/ DATATYPE* stateR__0__,DATATYPE* stateR__1__,DATATYPE* stateR__2__,DATATYPE* stateR__3__,DATATYPE* stateR__4__,DATATYPE* stateR__5__,DATATYPE* stateR__6__,DATATYPE* stateR__7__,DATATYPE* stateR__8__,DATATYPE* stateR__9__,DATATYPE* stateR__10__,DATATYPE* stateR__11__,DATATYPE* stateR__12__,DATATYPE* stateR__13__,DATATYPE* stateR__14__,DATATYPE* stateR__15__) {
  
  // Variables declaration
  DATATYPE _tmp6_0__;
  DATATYPE _tmp6_1__;
  DATATYPE _tmp6_10__;
  DATATYPE _tmp6_11__;
  DATATYPE _tmp6_12__;
  DATATYPE _tmp6_13__;
  DATATYPE _tmp6_14__;
  DATATYPE _tmp6_15__;
  DATATYPE _tmp6_2__;
  DATATYPE _tmp6_3__;
  DATATYPE _tmp6_4__;
  DATATYPE _tmp6_5__;
  DATATYPE _tmp6_6__;
  DATATYPE _tmp6_7__;
  DATATYPE _tmp6_8__;
  DATATYPE _tmp6_9__;

  // Instructions (body)
  DR_start__(state__0__,state__1__,state__2__,state__3__,state__4__,state__5__,state__6__,state__7__,state__8__,state__9__,state__10__,state__11__,state__12__,state__13__,state__14__,state__15__,&_tmp6_0__,&_tmp6_1__,&_tmp6_2__,&_tmp6_3__,&_tmp6_4__,&_tmp6_5__,&_tmp6_6__,&_tmp6_7__,&_tmp6_8__,&_tmp6_9__,&_tmp6_10__,&_tmp6_11__,&_tmp6_12__,&_tmp6_13__,&_tmp6_14__,&_tmp6_15__);
  DR_end__(_tmp6_0__,_tmp6_1__,_tmp6_2__,_tmp6_3__,_tmp6_4__,_tmp6_5__,_tmp6_6__,_tmp6_7__,_tmp6_8__,_tmp6_9__,_tmp6_10__,_tmp6_11__,_tmp6_12__,_tmp6_13__,_tmp6_14__,_tmp6_15__,&*stateR__0__,&*stateR__1__,&*stateR__2__,&*stateR__3__,&*stateR__4__,&*stateR__5__,&*stateR__6__,&*stateR__7__,&*stateR__8__,&*stateR__9__,&*stateR__10__,&*stateR__11__,&*stateR__12__,&*stateR__13__,&*stateR__14__,&*stateR__15__);

}

/* main function */
void Chacha20__ (/*inputs*/ DATATYPE plain__[16], /*outputs*/ DATATYPE cipher__[16]) {
  
  // Variables declaration
  DATATYPE state__1__0__;
  DATATYPE state__1__1__;
  DATATYPE state__1__10__;
  DATATYPE state__1__11__;
  DATATYPE state__1__12__;
  DATATYPE state__1__13__;
  DATATYPE state__1__14__;
  DATATYPE state__1__15__;
  DATATYPE state__1__2__;
  DATATYPE state__1__3__;
  DATATYPE state__1__4__;
  DATATYPE state__1__5__;
  DATATYPE state__1__6__;
  DATATYPE state__1__7__;
  DATATYPE state__1__8__;
  DATATYPE state__1__9__;

  // Instructions (body)
  DR__(plain__[0],plain__[1],plain__[2],plain__[3],plain__[4],plain__[5],plain__[6],plain__[7],plain__[8],plain__[9],plain__[10],plain__[11],plain__[12],plain__[13],plain__[14],plain__[15],&state__1__0__,&state__1__1__,&state__1__2__,&state__1__3__,&state__1__4__,&state__1__5__,&state__1__6__,&state__1__7__,&state__1__8__,&state__1__9__,&state__1__10__,&state__1__11__,&state__1__12__,&state__1__13__,&state__1__14__,&state__1__15__);
  DR__(state__1__0__,state__1__1__,state__1__2__,state__1__3__,state__1__4__,state__1__5__,state__1__6__,state__1__7__,state__1__8__,state__1__9__,state__1__10__,state__1__11__,state__1__12__,state__1__13__,state__1__14__,state__1__15__,&state__1__0__,&state__1__1__,&state__1__2__,&state__1__3__,&state__1__4__,&state__1__5__,&state__1__6__,&state__1__7__,&state__1__8__,&state__1__9__,&state__1__10__,&state__1__11__,&state__1__12__,&state__1__13__,&state__1__14__,&state__1__15__);
  DR__(state__1__0__,state__1__1__,state__1__2__,state__1__3__,state__1__4__,state__1__5__,state__1__6__,state__1__7__,state__1__8__,state__1__9__,state__1__10__,state__1__11__,state__1__12__,state__1__13__,state__1__14__,state__1__15__,&state__1__0__,&state__1__1__,&state__1__2__,&state__1__3__,&state__1__4__,&state__1__5__,&state__1__6__,&state__1__7__,&state__1__8__,&state__1__9__,&state__1__10__,&state__1__11__,&state__1__12__,&state__1__13__,&state__1__14__,&state__1__15__);
  DR__(state__1__0__,state__1__1__,state__1__2__,state__1__3__,state__1__4__,state__1__5__,state__1__6__,state__1__7__,state__1__8__,state__1__9__,state__1__10__,state__1__11__,state__1__12__,state__1__13__,state__1__14__,state__1__15__,&state__1__0__,&state__1__1__,&state__1__2__,&state__1__3__,&state__1__4__,&state__1__5__,&state__1__6__,&state__1__7__,&state__1__8__,&state__1__9__,&state__1__10__,&state__1__11__,&state__1__12__,&state__1__13__,&state__1__14__,&state__1__15__);
  DR__(state__1__0__,state__1__1__,state__1__2__,state__1__3__,state__1__4__,state__1__5__,state__1__6__,state__1__7__,state__1__8__,state__1__9__,state__1__10__,state__1__11__,state__1__12__,state__1__13__,state__1__14__,state__1__15__,&state__1__0__,&state__1__1__,&state__1__2__,&state__1__3__,&state__1__4__,&state__1__5__,&state__1__6__,&state__1__7__,&state__1__8__,&state__1__9__,&state__1__10__,&state__1__11__,&state__1__12__,&state__1__13__,&state__1__14__,&state__1__15__);
  DR__(state__1__0__,state__1__1__,state__1__2__,state__1__3__,state__1__4__,state__1__5__,state__1__6__,state__1__7__,state__1__8__,state__1__9__,state__1__10__,state__1__11__,state__1__12__,state__1__13__,state__1__14__,state__1__15__,&state__1__0__,&state__1__1__,&state__1__2__,&state__1__3__,&state__1__4__,&state__1__5__,&state__1__6__,&state__1__7__,&state__1__8__,&state__1__9__,&state__1__10__,&state__1__11__,&state__1__12__,&state__1__13__,&state__1__14__,&state__1__15__);
  DR__(state__1__0__,state__1__1__,state__1__2__,state__1__3__,state__1__4__,state__1__5__,state__1__6__,state__1__7__,state__1__8__,state__1__9__,state__1__10__,state__1__11__,state__1__12__,state__1__13__,state__1__14__,state__1__15__,&state__1__0__,&state__1__1__,&state__1__2__,&state__1__3__,&state__1__4__,&state__1__5__,&state__1__6__,&state__1__7__,&state__1__8__,&state__1__9__,&state__1__10__,&state__1__11__,&state__1__12__,&state__1__13__,&state__1__14__,&state__1__15__);
  DR__(state__1__0__,state__1__1__,state__1__2__,state__1__3__,state__1__4__,state__1__5__,state__1__6__,state__1__7__,state__1__8__,state__1__9__,state__1__10__,state__1__11__,state__1__12__,state__1__13__,state__1__14__,state__1__15__,&state__1__0__,&state__1__1__,&state__1__2__,&state__1__3__,&state__1__4__,&state__1__5__,&state__1__6__,&state__1__7__,&state__1__8__,&state__1__9__,&state__1__10__,&state__1__11__,&state__1__12__,&state__1__13__,&state__1__14__,&state__1__15__);
  DR__(state__1__0__,state__1__1__,state__1__2__,state__1__3__,state__1__4__,state__1__5__,state__1__6__,state__1__7__,state__1__8__,state__1__9__,state__1__10__,state__1__11__,state__1__12__,state__1__13__,state__1__14__,state__1__15__,&state__1__0__,&state__1__1__,&state__1__2__,&state__1__3__,&state__1__4__,&state__1__5__,&state__1__6__,&state__1__7__,&state__1__8__,&state__1__9__,&state__1__10__,&state__1__11__,&state__1__12__,&state__1__13__,&state__1__14__,&state__1__15__);
  DR__(state__1__0__,state__1__1__,state__1__2__,state__1__3__,state__1__4__,state__1__5__,state__1__6__,state__1__7__,state__1__8__,state__1__9__,state__1__10__,state__1__11__,state__1__12__,state__1__13__,state__1__14__,state__1__15__,&state__1__0__,&state__1__1__,&state__1__2__,&state__1__3__,&state__1__4__,&state__1__5__,&state__1__6__,&state__1__7__,&state__1__8__,&state__1__9__,&state__1__10__,&state__1__11__,&state__1__12__,&state__1__13__,&state__1__14__,&state__1__15__);
  cipher__[0] = state__1__0__;
  cipher__[1] = state__1__1__;
  cipher__[2] = state__1__2__;
  cipher__[3] = state__1__3__;
  cipher__[4] = state__1__4__;
  cipher__[5] = state__1__5__;
  cipher__[6] = state__1__6__;
  cipher__[7] = state__1__7__;
  cipher__[8] = state__1__8__;
  cipher__[9] = state__1__9__;
  cipher__[10] = state__1__10__;
  cipher__[11] = state__1__11__;
  cipher__[12] = state__1__12__;
  cipher__[13] = state__1__13__;
  cipher__[14] = state__1__14__;
  cipher__[15] = state__1__15__;

}


/* **************************************************************** */
/*                            Usuba source                          */
/*                                                                  */
/*

 node QR_start(a :  u32x1 :: base,b :  u32x1 :: base,c :  u32x1 :: base,d :  u32x1 :: base)
  returns aR :  u32x1 :: base,bR :  u32x1 :: base,cR :  u32x1 :: base,dR :  u32x1 :: base
vars

let
  (aR) = (a + b);
  (dR) = ((d ^ aR) <<< 16);
  (cR) = (c + dR);
  (bR) = ((b ^ cR) <<< 12)
tel

 node QR_end(a :  u32x1 :: base,b :  u32x1 :: base,c :  u32x1 :: base,d :  u32x1 :: base)
  returns aR :  u32x1 :: base,bR :  u32x1 :: base,cR :  u32x1 :: base,dR :  u32x1 :: base
vars

let
  (aR) = (a + b);
  (dR) = ((d ^ aR) <<< 8);
  (cR) = (c + dR);
  (bR) = ((b ^ cR) <<< 7)
tel

 node QR(input :  u32x4 :: base)
  returns output :  u32x4 :: base
vars

let
  (output) = QR_end(QR_start(input))
tel

 node DR_start(state :  u32x16 :: base)
  returns stateR :  u32x16 :: base
vars

let
  (stateR[0,4,8,12]) = QR(state[0,4,8,12]);
  (stateR[1,5,9,13]) = QR(state[1,5,9,13]);
  (stateR[2,6,10,14]) = QR(state[2,6,10,14]);
  (stateR[3,7,11,15]) = QR(state[3,7,11,15])
tel

 node DR_end(state :  u32x16 :: base)
  returns stateR :  u32x16 :: base
vars

let
  (stateR[0,5,10,15]) = QR(state[0,5,10,15]);
  (stateR[1,6,11,12]) = QR(state[1,6,11,12]);
  (stateR[2,7,8,13]) = QR(state[2,7,8,13]);
  (stateR[3,4,9,14]) = QR(state[3,4,9,14])
tel

_no_inline node DR(state :  u32x16 :: base)
  returns stateR :  u32x16 :: base
vars

let
  (stateR) = DR_end(DR_start(state))
tel

 node Chacha20(plain :  u32x16 :: base)
  returns cipher :  u32x16 :: base
vars
  state :  u32x16[11] :: base
let
  (state[0]) = plain;
  _no_unroll forall i in [1,10] {
    (state[i]) = DR(state[(i - 1)])
  };
  (cipher) = state[10]
tel

*/
 